<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SchoolTools - Addition Practice</title>
        <link rel="stylesheet" href="/static/style/global.css" />
        <script type="module" src="/static/js/global.js"></script>
    </head>
    <body>
        <header></header>
        <main>
            <form id="hide-this">
                <h2>Arithmetic Practice</h2>
                <p>
                    Choose which operations you'd like to study:
                </p>
                <select name="base" value="simple">
                    <option value="simple" selected>Simple</option>
                    <option value="multi">Multi</option>
                </select>
                <select name="operation" value="addsubtract">
                    <option value="addsubtract" selected>Addition and Subtraction</option>
                    <option value="add">Addition</option>
                    <option value="subtract">Subtraction</option>
                </select>
                <input type="submit" value="Play" />
            </form>
            <div id="study-game">
            </div>
        </main>
        <footer></footer>
        <script type="module">
            import ready from "/static/js/common/ready.js";
            import handleForm from "/static/js/common/form.js";
            import StudyGame from "/static/js/pages/studygame.js";
            import {randArr, randInt} from "/static/js/common/random.js";
            
            handleForm(async result => {
                doc.el("#hide-this").style.display = "none";
                
                
                const base = result.get("base");
                const type = result.get("operation");
                
                const getDigit = () => randInt(0,9);
                const getOperand = () => {
                    let operands = [];
                    if(type == "add" || type == "addsubtract")
                        operands.push("+")
                    if(type == "subtract" || type == "addsubtract")
                        operands.push("-")
                    return randArr(operands);
                }
                
                const getEquation = () => {
                    
                    let equation = randInt(0, 9);
                    let result = equation;
                    
                    for(let i = 0; i < (base == "multi" ? randInt(1, 3) : 1); i++) {
                        let digit = getDigit();
                        let operand = getOperand();
                        equation += " "+operand;
                        equation += " "+digit;
                        
                        if(operand == "+")
                            result += digit;
                        if(operand == "-")
                            result -= digit;
                        
                    }
                    
                    return {equation, result};
                }
                
                new StudyGame(doc.el("#study-game"), (game) => {
                    
                    const correct = getEquation();
                    const answers = [];
                    let correctAnswer = null;
                    
                    let prob = 4;
                    for(let i = 0; i < 4; i++) {
                        if(randInt(0, --prob) == 0 && correctAnswer === null) {
                            correctAnswer = answers.length;
                            answers.push(correct.result)
                        } else {
                            let proposedAnswer = null;
                            while(
                                proposedAnswer == null ||
                                answers.includes(proposedAnswer) ||
                                correct.result == proposedAnswer
                            ) {
                                proposedAnswer = randArr([
                                    correct.result - randInt(-2, 2),
                                    correct.result - randInt(-2, 2),
                                    correct.result - randInt(-2, 2),
                                    getEquation().result
                                ])
                            }
                            answers.push(proposedAnswer);
                        }
                    }
                    
                    game.ask({
                        question: correct.equation,
                        answers,
                        correctAnswer
                    })
                    
                });
            })
            
        </script>
    </body>
</html>